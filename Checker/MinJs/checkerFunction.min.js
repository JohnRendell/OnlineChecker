(localStorage.getItem("host")||localStorage.getItem("invited-player"))&&localStorage.setItem("gameSurrender",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse("manual"),"gameSurrender").toString());var global_username=null,global_profile=null,global_trophy="Guest-Mode",global_requestCount="Guest-Mode";async function fillInfo(){var e=window.location.href.split("/");let t=e[e.length-2];localStorage.getItem("lobbyType")||localStorage.setItem("lobbyType",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t),"lobbyType").toString()),localStorage.getItem("lobbyType")&&(e=CryptoJS.AES.decrypt(localStorage.getItem("lobbyType"),"lobbyType").toString(CryptoJS.enc.Utf8))&&e!==t&&(window.location.href="/");try{var o=await(await fetch("/fillInfo",{method:"POST",headers:{"Content-Type":"Application/json",Accept:"Application/json"},body:JSON.stringify({guaranteedAccess:!0})})).json();"success"===o.message?(global_username=o.username,global_profile=o.profile,global_trophy=o.trophy):(global_username=o.username,global_profile=o.profile),imInLobby(!0,global_username),(localStorage.getItem("host")||localStorage.getItem("invited-player"))&&getPlayersData(),setTimeout(()=>{getWatchPlayersData()},100)}catch(e){console.log(e)}}function typeInput(e,t,o){t=document.getElementById(t),e=document.getElementById(e);t.innerText=e.value.length+"/"+o}fillInfo();var global_opponent_username=null,global_opponent_profile=null,global_opponent_trophy=null,global_opponent_requestCount=null;function getPlayersData(){document.getElementById("yourUserData").innerText=global_username,document.getElementById("yourProfileData").src=global_profile,document.getElementById("yourTrophyData").innerText="Trophy: "+global_trophy,document.getElementById("myourUserData").innerText=global_username,document.getElementById("myourProfileData").src=global_profile,document.getElementById("myourTrophyData").innerText="Trophy: "+global_trophy;var e,t=async e=>{e=await(await fetch("/checker/getOpponentData",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:e})})).json();"success"===e.message&&(global_opponent_username=e.username,global_opponent_profile=e.profile,global_opponent_trophy=e.trophy,document.getElementById("opponentUserData").innerText=e.username,document.getElementById("opponentProfileData").src=e.profile,document.getElementById("opponentTrophyData").innerText="Trophy: "+e.trophy,document.getElementById("mopponentUserData").innerText=e.username,document.getElementById("mopponentProfileData").src=e.profile,document.getElementById("mopponentTrophyData").innerText="Trophy: "+e.trophy,playerTurn())};localStorage.getItem("invited-player")&&(e=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8))&&t(e),localStorage.getItem("host")&&(e=CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8))&&t(e),localStorage.getItem("host")||localStorage.getItem("invited-player")||localStorage.getItem("spectator")||(window.location.href="/")}async function getWatchPlayersData(){var e,t,o;localStorage.getItem("spectator")&&localStorage.getItem("player_invited")&&localStorage.getItem("player_host")&&(e=CryptoJS.AES.decrypt(localStorage.getItem("spectator"),"spectator").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("player_host"),"player_host").toString(CryptoJS.enc.Utf8),o=CryptoJS.AES.decrypt(localStorage.getItem("player_invited"),"player_invited").toString(CryptoJS.enc.Utf8),e)&&t&&o&&"success"===(e=await(await fetch("/checker/getPlayerData",{method:"POST",headers:{"Content-Type":"Application/json",Accept:"Application/json"},body:JSON.stringify({playerHost:t,playerInvited:o})})).json()).message&&(document.getElementById("yourUserData").innerText=e.hostName,document.getElementById("yourProfileData").src=e.hostProfile,document.getElementById("yourTrophyData").innerText="Trophy: "+e.hostTrophy,document.getElementById("myourUserData").innerText=e.hostName,document.getElementById("myourProfileData").src=e.hostProfile,document.getElementById("myourTrophyData").innerText="Trophy: "+e.hostTrophy,document.getElementById("opponentUserData").innerText=e.invitedName,document.getElementById("opponentProfileData").src=e.invitedProfile,document.getElementById("opponentTrophyData").innerText="Trophy: "+e.invitedTrophy,document.getElementById("mopponentUserData").innerText=e.invitedName,document.getElementById("mopponentProfileData").src=e.invitedProfile,document.getElementById("mopponentTrophyData").innerText="Trophy: "+e.invitedTrophy,localStorage.getItem("turnIndicator")||(t=document.getElementById("userTurnProfile"),o=document.getElementById("userTurnIndicator"),t&&(t.src=e.hostProfile),o&&(o.innerText=e.hostName+" turn"),localStorage.setItem("turnIndicator",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse("yes"),"turnIndicator").toString())),spectatorPlayerTurn())}function addLobbyToWatchLive(){var e,t,o;localStorage.getItem("lobbyType")&&localStorage.getItem("lobby-room")&&localStorage.getItem("invited-player")&&(e=CryptoJS.AES.decrypt(localStorage.getItem("lobbyType"),"lobbyType").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8),e)&&t&&(o=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8))&&socket.emit("addLobby",e,t,global_username,o)}async function spectatorPlayerTurn(){var e=document.getElementById("userTurnProfile"),t=document.getElementById("userTurnIndicator"),o=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8);if(o&&e&&t)try{var r=await(await fetch("/lobby/lobbyData",{method:"POST",headers:{"Content-Type":"Application/json",Accept:"Application/json"},body:JSON.stringify({lobbyRoom:o})})).json();"success"===r.message&&(e.src=r.playerProfile,t.innerText=r.playerName+" turn")}catch(e){console.log(e)}}function playerTurn(){var t=document.getElementById("userTurnProfile"),o=document.getElementById("userTurnIndicator");if(localStorage.getItem("host")||localStorage.getItem("invited-player"))if(localStorage.getItem("turnIndicator")){let e=CryptoJS.AES.decrypt(localStorage.getItem("turnIndicator"),"turnIndicator").toString(CryptoJS.enc.Utf8);e&&("yes"===e&&(t&&(t.src=global_profile),o)&&(o.innerText=global_username+" turn"),"no"===e&&(t&&(t.src=global_opponent_profile),o)&&(o.innerText=global_opponent_username+" turn"),localStorage.setItem("turnIndicator",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),"turnIndicator").toString()))}else{let e=localStorage.getItem("invited-player")?"yes":"no";"yes"==e&&(t&&(t.src=global_profile),o)&&(o.innerText=global_username+" turn"),"no"==e&&(t&&(t.src=global_opponent_profile),o)&&(o.innerText=global_opponent_username+" turn");localStorage.setItem("turnIndicator",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),"turnIndicator").toString())}}function boardAssemble(){var o=document.getElementById("checkerBoard"),r="ABCDEFGH";for(let t=0;t<8;t++)for(let e=0;e<8;e++){var n=document.createElement("div"),a=(t+e)%2==0?"bg-white":"bg-black";n.setAttribute("class","flex justify-center items-center w-full h-full "+a),n.setAttribute("id","tile_"+(t+1)+r.charAt(e)),n.setAttribute("onclick",'moveToTiles("tile_'+(t+1)+r.charAt(e)+'")'),o.appendChild(n)}}function checkerAssemble(){let t=document.getElementById("checkerBoard"),o=13,r=0;if(localStorage.getItem("host")||localStorage.getItem("invited-player")||localStorage.getItem("spectator"))for(let e=0;e<t.childElementCount;e++){var n,a,l,i,c,p=t.children[e],s=document.createElement("div"),m=document.createElement("div");s.setAttribute("class","w-[80%] h-[80%] rounded-full border-2 border-black bg-blue-500 cursor-pointer flex items-center justify-center"),m.setAttribute("class","w-[80%] h-[80%] rounded-full border-2 border-black bg-red-500 flex items-center justify-center"),(p.id.startsWith("tile_6A")||p.id.startsWith("tile_6C")||p.id.startsWith("tile_6E")||p.id.startsWith("tile_6G")||p.id.startsWith("tile_7B")||p.id.startsWith("tile_7D")||p.id.startsWith("tile_7F")||p.id.startsWith("tile_7H")||p.id.startsWith("tile_8A")||p.id.startsWith("tile_8C")||p.id.startsWith("tile_8E")||p.id.startsWith("tile_8G"))&&(r++,(a=document.createElement("input")).setAttribute("id","pieceInput"+r),a.setAttribute("class","hidden"),a.setAttribute("value","pawn"),s.setAttribute("id","piece"+r),s.setAttribute("onclick",'showAvailableMove("pieceInput'+r+'", "piece'+r+'")'),s.appendChild(a),localStorage.getItem("piece"+r+"_pos")&&((n=CryptoJS.AES.decrypt(localStorage.getItem("piece"+r+"_pos"),"piece"+r+"_pos").toString(CryptoJS.enc.Utf8))&&(n=document.getElementById(n))?n.appendChild(s):window.location.href="/Invalid/GameTerminated"),localStorage.getItem("eaten_piece"+r)&&((n=CryptoJS.AES.decrypt(localStorage.getItem("eaten_piece"+r),"eaten_piece"+r).toString(CryptoJS.enc.Utf8))?document.getElementById(n)&&document.getElementById(n).remove():window.location.href="/ModifiedPiece/GameTerminated"),localStorage.getItem("pieceInput"+r)&&((l=CryptoJS.AES.decrypt(localStorage.getItem("pieceInput"+r),"pieceInput"+r).toString(CryptoJS.enc.Utf8))?"queen"===l?((i=document.createElement("img")).setAttribute("class","w-full h-full"),i.setAttribute("src","/Images/Crown.png"),i.setAttribute("alt","Crown icon"),a.setAttribute("value","queen"),s.appendChild(i)):a.setAttribute("value","pawn"):window.location.href="/ModifiedPiece/GameTerminated"),localStorage.getItem("pieceInput"+r)||localStorage.getItem("piece"+r)||localStorage.getItem("eaten_piece"+r)||localStorage.getItem("piece"+r+"_pos")||p.appendChild(s)),(p.id.startsWith("tile_1B")||p.id.startsWith("tile_1D")||p.id.startsWith("tile_1F")||p.id.startsWith("tile_1H")||p.id.startsWith("tile_2A")||p.id.startsWith("tile_2C")||p.id.startsWith("tile_2E")||p.id.startsWith("tile_2G")||p.id.startsWith("tile_3B")||p.id.startsWith("tile_3D")||p.id.startsWith("tile_3F")||p.id.startsWith("tile_3H"))&&(o--,(a=document.createElement("input")).setAttribute("id","opponent_pieceInput"+o),a.setAttribute("class","hidden"),a.setAttribute("value","pawn"),m.setAttribute("id","opponent_piece"+o),m.appendChild(a),localStorage.getItem("opponent_piece"+o+"_pos")&&((l=CryptoJS.AES.decrypt(localStorage.getItem("opponent_piece"+o+"_pos"),"opponent_piece"+o+"_pos").toString(CryptoJS.enc.Utf8))&&(s=document.getElementById(l))?s.appendChild(m):window.location.href="/Invalid/GameTerminated"),localStorage.getItem("eaten_opponent_piece"+o)&&((s=CryptoJS.AES.decrypt(localStorage.getItem("eaten_opponent_piece"+o),"eaten_opponent_piece"+o).toString(CryptoJS.enc.Utf8))?document.getElementById(s)&&document.getElementById(s).remove():window.location.href="/ModifiedPiece/GameTerminated"),localStorage.getItem("opponent_pieceInput"+o)&&((s=CryptoJS.AES.decrypt(localStorage.getItem("opponent_pieceInput"+o),"opponent_pieceInput"+o).toString(CryptoJS.enc.Utf8))?"queen"===s?((i=document.createElement("img")).setAttribute("class","w-full h-full"),i.setAttribute("src","/Images/Crown.png"),i.setAttribute("alt","Crown icon"),m.appendChild(i),a.setAttribute("value","queen")):a.setAttribute("value","pawn"):window.location.href="/ModifiedPiece/GameTerminated"),localStorage.getItem("opponent_pieceInput"+o)||localStorage.getItem("eaten_opponent_piece"+o)||localStorage.getItem("opponent_piece"+o)||localStorage.getItem("opponent_piece"+o+"_pos")||p.appendChild(m));for(c of p.childNodes)c.id.startsWith("piece")||c.id.startsWith("opponent")||c.remove()}}async function spectatorCheckerAssemble(){try{var e=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8);if(e){var t=await(await fetch("/lobby/lobbyData",{method:"POST",headers:{"Content-Type":"Application/json",Accept:"Application/json"},body:JSON.stringify({lobbyRoom:e})})).json();if("success"===t.message){var o,r,n,a,l,i,c,p=t.blueTeamPos,s=t.redTeamPos;for(let e=0;e<p.length;e++)p[e]&&(o=document.getElementById(p[e].pieceID),r=document.getElementById(p[e].tileID),o&&r&&r.appendChild(o),p[e].eaten_piece&&(n=p[e].eaten_piece,document.getElementById(n))&&document.getElementById(n).remove(),p[e].promotePiece)&&((c=document.createElement("img")).setAttribute("class","w-full h-full"),c.setAttribute("src","/Images/Crown.png"),c.setAttribute("alt","Crown icon"),document.getElementById(p[e].promotePiece).appendChild(c));for(let e=0;e<s.length;e++)s[e]&&(a=document.getElementById(s[e].pieceID),l=document.getElementById(s[e].tileID),a&&l&&l.appendChild(a),s[e].eaten_piece&&(i=s[e].eaten_piece,document.getElementById(i))&&document.getElementById(i).remove(),s[e].promotePiece)&&((c=document.createElement("img")).setAttribute("class","w-full h-full"),c.setAttribute("src","/Images/Crown.png"),c.setAttribute("alt","Crown icon"),document.getElementById(s[e].promotePiece).appendChild(c))}}}catch(e){console.log(e)}}function startTime(){let e=document.getElementById("checkerTime"),t,o;var r=CryptoJS.AES.decrypt(localStorage.getItem("minute"),"minute").toString(CryptoJS.enc.Utf8),n=CryptoJS.AES.decrypt(localStorage.getItem("sec"),"sec").toString(CryptoJS.enc.Utf8);r&&n&&(t=parseInt(r),o=parseInt(n)),e.innerText="10:00";let a=setInterval(()=>{0===t&&0===o?(clearInterval(a),e.innerText="00:00",checkBoardStatus()):(0===o?(o=59,t--):o--,e.innerText=(t<10?"0"+t:t)+":"+(o<10?"0"+o:o),localStorage.setItem("minute",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t),"minute").toString()),localStorage.setItem("sec",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(o),"sec").toString()),socket.emit("spectator_time",t,o,localStorage.getItem("lobby-room")),socket.emit("game_time",t,o,localStorage.getItem("lobby-room")))},1e3)}function gameMessage(){var e,t,o,r,n,a=document.getElementById("messageInputGame");a.value&&(e=document.getElementById("gameMessageConversation"),(r=document.createElement("div")).setAttribute("class","flex justify-start w-full h-auto"),e.appendChild(r),(t=document.createElement("div")).setAttribute("class","flex flex-col space-y-2 w-fit h-fit"),r.appendChild(t),(r=document.createElement("div")).setAttribute("class","flex flex-row space-x-2 items-center justify-start"),t.appendChild(r),(n=document.createElement("img")).setAttribute("alt","user profile"),n.setAttribute("class","w-[2rem] h-[2rem] text-sm border-2 border-blue-500 rounded-full"),n.setAttribute("src",global_profile),r.appendChild(n),(n=document.createElement("p")).setAttribute("class","font-Pixelify text-black font-bold text-sm"),o=localStorage.getItem("spectator")?"(Spectator)":"",n.appendChild(document.createTextNode(global_username+o)),r.appendChild(n),(o=document.createElement("div")).setAttribute("class","w-[10rem] h-auto text-left bg-blue-500 rounded-2xl p-2 md:w-[15rem]"),t.appendChild(o),(r=document.createElement("p")).setAttribute("class","font-Pixelify text-white text-sm"),r.appendChild(document.createTextNode(a.value)),o.appendChild(r),n=localStorage.getItem("lobby-room"),socket.emit("gameMessage",a.value,global_username,global_profile,n),document.getElementById("messageInputGame").value="",document.getElementById("messageInputGameCount").innerText="0/80",e.scrollTo(0,e.scrollHeight))}function resetCount(){messageCount=0,document.getElementById("notifMsg_game").style.display="none"}async function surrenderPanel(){var e=()=>{if(localStorage.getItem("host")){var e=CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8);if(e)return e}},t=()=>{if(localStorage.getItem("minute")&&localStorage.getItem("sec")){var e=CryptoJS.AES.decrypt(localStorage.getItem("minute"),"minute").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("sec"),"sec").toString(CryptoJS.enc.Utf8);if(e&&t)return(e<10?"0"+e:e)+":"+(t<10?"0"+t:t)}window.location.href="/Modified_saved/GameTerminated"};try{var o,r=await(await fetch("/history/addHistory",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_username,opponent:(void 0!==e()?e:()=>{if(localStorage.getItem("invited-player")){var e=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8);if(e)return e}})(),lobbyType:(()=>{if(localStorage.getItem("lobbyType")){var e=CryptoJS.AES.decrypt(localStorage.getItem("lobbyType"),"lobbyType").toString(CryptoJS.enc.Utf8);if(e)return e;window.location.href="/Modified_saved/GameTerminated"}})(),time:t(),win_status:"lose",trophy:global_trophy})})).json();"success"===r.message&&(modalStatus("surrenderNotifModal","surrenderNotifContainer","flex","modal_animation"),document.getElementById("surrenderNotif-text-display").innerText=global_username+" surrendered",document.getElementById("win-status").innerText="You lose",document.getElementById("win-status").style.color="red",document.getElementById("win-status-time-display").innerText="Time Remaining: "+t(),"Match"===r.status?(document.getElementById("win-status-trophy").innerText="Trophy now: "+r.trophy,document.getElementById("win-status-trophy").style.color="red"):document.getElementById("win-status-trophy").innerText="You cannot earn or decrease trophy in custom mode",o=localStorage.getItem("lobby-room"),socket.emit("checker-player-surrender",global_username,o))}catch(e){console.log(e)}}async function dashboard(){var e,t;localStorage.setItem("gameSurrender",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse("default"),"gameSurrender").toString()),document.getElementById("loadingSpinner").style.display="flex",document.getElementById("validateText").innerText="Validating, please wait...",await(await fetch("/cookie/getCookie")).json()&&(e=CryptoJS.AES.decrypt((e=localStorage.getItem("username"),t="_",e.replace(new RegExp(t,"g"),"/")),"username").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8),e)&&t&&(imInLobby(!1,global_username),socket.emit("room-status",t,"leave"),document.getElementById("loadingSpinner").style.display="none",window.location.href="/dashboard/"+(e=localStorage.getItem("username"),t="_",e.replace(/\//g,t)))}setTimeout(()=>{addLobbyToWatchLive()},100),boardAssemble(),localStorage.getItem("spectator")&&spectatorCheckerAssemble(),checkerAssemble(),setTimeout(()=>{localStorage.getItem("minute")&&localStorage.getItem("sec")&&localStorage.getItem("invited-player")&&startTime()},1e3);