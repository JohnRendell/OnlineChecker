function resetTileColor(o){var r="ABCDEFGH";for(let t=0;t<8;t++)for(let e=0;e<8;e++){var n=(t+e)%2==0?"white":"black",i=document.getElementById(o).parentNode.id;document.getElementById("tile_"+(t+1)+r.charAt(e))!=i&&(document.getElementById("tile_"+(t+1)+r.charAt(e)).style.backgroundColor=n)}}function moveToTiles(o){if(localStorage.getItem("turnIndicator")&&(localStorage.getItem("host")||localStorage.getItem("invited-player"))){var e=CryptoJS.AES.decrypt(localStorage.getItem("turnIndicator"),"turnIndicator").toString(CryptoJS.enc.Utf8);let f=[],t=document.getElementById(o);if(e&&"yes"===e){if(t&&"green"===t.style.backgroundColor){let e=CryptoJS.AES.decrypt(localStorage.getItem("pieceID"),"pieceID").toString(CryptoJS.enc.Utf8);if(e){var r=document.getElementById(e),r=(t.appendChild(r),localStorage.setItem("destinationTileID",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(o),"destinationTileID").toString()),i="pieceInput"+e.substring(5).trim(),!(n=document.getElementById(i))||"pawn"!==n.value||"tile_1B"!==o&&"tile_1D"!==o&&"tile_1F"!==o&&"tile_1H"!==o||(modalStatus("promotedModal","promotedContainer","flex","modal_animation"),document.getElementById("promoteLabel").innerText=global_username+" piece's promoted",n.value="queen",(o=document.createElement("img")).setAttribute("class","w-full h-full"),o.setAttribute("src","/Images/Crown.png"),o.setAttribute("alt","Crown icon"),r.appendChild(o),document.getElementById("promotedContainer").addEventListener("animationend",()=>{setTimeout(()=>{modalStatus("promotedModal","promotedContainer","none",null)},1e3)}),localStorage.setItem(i,CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(n.value),i).toString()),localStorage.getItem("invited-player")&&socket.emit("spectator_promoteBlue",e,i,localStorage.getItem("lobby-room"),global_username)),CryptoJS.AES.decrypt(localStorage.getItem("originTileID"),"originTileID").toString(CryptoJS.enc.Utf8)),o=CryptoJS.AES.decrypt(localStorage.getItem("destinationTileID"),"destinationTileID").toString(CryptoJS.enc.Utf8),n=(r&&o?((e,t)=>{var o="abcdefgh".toUpperCase().split(""),t=t.split("");let r=t[t.length-1];var n=t[t.length-2];let i=o.findIndex(e=>r==e);t=e.split("");let l=t[t.length-1];var a,d=t[t.length-2];let c=o.findIndex(e=>l==e);if(i>c&&d<n)for(let e=n-1;e>d;e--)if(i--,a=document.getElementById("tile_"+e+o[i]))for(var p of a.children)p&&p.id.startsWith("opponent")&&f.push(p.id);if(c>i&&d<n)for(let e=n-1;e>d;e--)if(i++,a=document.getElementById("tile_"+e+o[i]))for(var s of a.children)s&&s.id.startsWith("opponent")&&f.push(s.id);if(i>c&&n<d)for(let e=d-1;e>n;e--)if(c++,a=document.getElementById("tile_"+e+o[c]))for(var g of a.children)g&&g.id.startsWith("opponent")&&f.push(g.id);if(c>i&&n<d)for(let e=d-1;e>n;e--)if(c--,a=document.getElementById("tile_"+e+o[c]))for(var m of a.children)m&&m.id.startsWith("opponent")&&f.push(m.id)})(o,r):window.location.href="/ModifiedTileID/GameTerminated",resetTileColor(e),CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8));if(n&&(localStorage.getItem("host")||localStorage.getItem("invited-player"))){if(0<f.length){localStorage.setItem("turnIndicator",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse("yes"),"turnIndicator").toString());for(let e of f)document.getElementById(e).style.animation="shrinkPiece 1s normal forwards",localStorage.setItem("eaten_"+e,CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),"eaten_"+e).toString()),document.getElementById(e).addEventListener("animationend",()=>{document.getElementById(e).remove()}),localStorage.getItem("invited-player")&&socket.emit("spectator_eatenEnemy",e,localStorage.getItem("lobby-room"));socket.emit("checker-player-eat-piece",f,n)}else{localStorage.setItem("turnIndicator",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse("no"),"turnIndicator").toString());i=document.getElementById("userTurnProfile"),o=document.getElementById("userTurnIndicator");i&&o&&(i.src=global_opponent_profile,o.innerText=global_opponent_username+" turn")}localStorage.getItem("invited-player")&&(r=CryptoJS.AES.decrypt(localStorage.getItem("turnIndicator"),"turnIndicator").toString(CryptoJS.enc.Utf8))&&socket.emit("spectator_turnIndicator",localStorage.getItem("turnIndicator"),n,"yes"===r?global_username:global_opponent_username,"yes"===r?global_profile:global_opponent_profile),checkBoardStatus(),socket.emit("checker-player-turn",localStorage.getItem("turnIndicator"),n);i=CryptoJS.AES.decrypt(localStorage.getItem("destinationTileID"),"destinationTileID").toString(CryptoJS.enc.Utf8);i&&(savePiecePos(e,i),socket.emit("checker-player-move",e,i,n))}else window.location.href="/invalidRoom/GameTerminated"}}}else e||(window.location.href="/InvalidTurn/GameTerminated")}var i,n}function savePiecePos(e,t){localStorage.setItem(e+"_pos",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t),e+"_pos").toString()),localStorage.getItem("invited-player")&&socket.emit("spectator_moveBlue",e,t,localStorage.getItem("lobby-room"))}function showAvailableMove(e,t){localStorage.setItem("pieceID",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t),"pieceID").toString()),resetTileColor(t);var o,t=document.getElementById(t).parentNode,e=document.getElementById(e);localStorage.setItem("originTileID",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t.id),"originTileID").toString());localStorage.getItem("turnIndicator")&&(o=CryptoJS.AES.decrypt(localStorage.getItem("turnIndicator"),"turnIndicator").toString(CryptoJS.enc.Utf8))&&"yes"===o&&(localStorage.getItem("host")||localStorage.getItem("invited-player"))&&(((e,t)=>{var o,r="abcdefgh".toUpperCase().split(""),t=t.id.split("");let n=t[t.length-1],i=t[t.length-2],l=r.findIndex(e=>n==e),a=!1;if("queen"===e)for(let e=0;e<8;e++)if(l--,i--,o=document.getElementById("tile_"+i+r[l])){for(var d of o.children)if(d&&d.id.startsWith("piece")){a=!0;break}for(var c of o.children)if(c&&c.id.startsWith("opponent_piece")){c=c.parentNode.id.split("");let t=c[c.length-1];var c=c[c.length-2],p=r.findIndex(e=>t==e);if(p--,c--,f=document.getElementById("tile_"+c+r[p]))for(var s of f.children)if(s&&s.id.startsWith("opponent_piece")){a=!0;break}break}0===o.childElementCount&&0==a&&(o.style.backgroundColor="green")}if("pawn"===e&&(l--,i--,o=document.getElementById("tile_"+i+r[l]))){for(var g of o.children)if(g&&g.id.startsWith("piece")){a=!0;break}for(var m of o.children)if(m&&m.id.startsWith("opponent_piece")){m=m.parentNode.id.split("");let t=m[m.length-1];var f,m=m[m.length-2],y=r.findIndex(e=>t==e);if(y--,m--,f=document.getElementById("tile_"+m+r[y])){for(var u of f.children)if(u&&u.id.startsWith("opponent_piece")){a=!0;break}0===f.childElementCount&&(f.style.backgroundColor="green")}break}0===o.childElementCount&&0==a&&(o.style.backgroundColor="green")}})(e.value,t),((e,t)=>{var o,r="abcdefgh".toUpperCase().split(""),t=t.id.split("");let n=t[t.length-1],i=t[t.length-2],l=r.findIndex(e=>n==e),a=!1;if("queen"===e){for(let e=0;e<8;e++)if(l++,i--,o=document.getElementById("tile_"+i+r[l])){for(var d of o.children)if(d&&d.id.startsWith("piece")){a=!0;break}for(var c of o.children)if(c&&c.id.startsWith("opponent_piece")){c=c.parentNode.id.split("");let t=c[c.length-1];var c=c[c.length-2],p=r.findIndex(e=>t==e);if(p++,c--,f=document.getElementById("tile_"+c+r[p]))for(var s of f.children)if(s&&s.id.startsWith("opponent_piece")){a=!0;break}break}0===o.childElementCount&&0==a&&(o.style.backgroundColor="green")}}else if("pawn"===e)if(l++,i--,o=document.getElementById("tile_"+i+r[l])){for(var g of o.children)if(g&&g.id.startsWith("piece")){a=!0;break}for(var m of o.children)if(m&&m.id.startsWith("opponent_piece")){m=m.parentNode.id.split("");let t=m[m.length-1];var f,m=m[m.length-2],y=r.findIndex(e=>t==e);if(y++,m--,f=document.getElementById("tile_"+m+r[y])){for(var u of f.children)if(u&&u.id.startsWith("opponent_piece")){a=!0;break}0===f.childElementCount&&(f.style.backgroundColor="green")}break}0===o.childElementCount&&0==a&&(o.style.backgroundColor="green")}})(e.value,t),((e,t)=>{var o="abcdefgh".toUpperCase().split(""),t=t.id.split("");let r=t[t.length-1],n=t[t.length-2],i=o.findIndex(e=>r==e),l=!1;if("queen"===e)for(let e=0;e<8;e++){i--,n++;var a=document.getElementById("tile_"+n+o[i]);if(a){for(var d of a.children)if(d&&d.id.startsWith("piece")){l=!0;break}for(var c of a.children)if(c&&c.id.startsWith("opponent_piece")){c=c.parentNode.id.split("");let t=c[c.length-1];var c=c[c.length-2],p=o.findIndex(e=>t==e),c=(p--,c++,document.getElementById("tile_"+c+o[p]));if(c)for(var s of c.children)if(s&&s.id.startsWith("opponent_piece")){l=!0;break}break}0===a.childElementCount&&0==l&&(a.style.backgroundColor="green")}}})(e.value,t),((e,t)=>{var o="abcdefgh".toUpperCase().split(""),t=t.id.split("");let r=t[t.length-1],n=t[t.length-2],i=o.findIndex(e=>r==e),l=!1;if("queen"===e)for(let e=0;e<8;e++){i++,n++;var a=document.getElementById("tile_"+n+o[i]);if(a){for(var d of a.children)if(d&&d.id.startsWith("piece")){l=!0;break}for(var c of a.children)if(c&&c.id.startsWith("opponent_piece")){c=c.parentNode.id.split("");let t=c[c.length-1];var c=c[c.length-2],p=o.findIndex(e=>t==e),c=(p++,c++,document.getElementById("tile_"+c+o[p]));if(c)for(var s of c.children)if(s&&s.id.startsWith("opponent_piece")){l=!0;break}break}0===a.childElementCount&&0==l&&(a.style.backgroundColor="green")}}})(e.value,t))}async function checkBoardStatus(){let t=0,o=0,r=document.getElementById("checkerBoard");for(let e=0;e<r.childElementCount;e++){var n=r.children[e];if(n){var i=document.getElementById(n.id);if(i&&0<i.childElementCount)for(let e=0;e<i.childElementCount;e++){var l=i.children[e];l&&l.id.startsWith("opponent")&&t++,l&&l.id.startsWith("piece")&&o++}}}var e=()=>{if(localStorage.getItem("host")){var e=CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8);if(e)return e}},a=()=>{if(localStorage.getItem("minute")&&localStorage.getItem("sec")){var e=CryptoJS.AES.decrypt(localStorage.getItem("minute"),"minute").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("sec"),"sec").toString(CryptoJS.enc.Utf8);if(e&&t)return(e<10?"0"+e:e)+":"+(t<10?"0"+t:t)}window.location.href="/Modified_saved/GameTerminated"},d=CryptoJS.AES.decrypt(localStorage.getItem("minute"),"minute").toString(CryptoJS.enc.Utf8),c=CryptoJS.AES.decrypt(localStorage.getItem("sec"),"sec").toString(CryptoJS.enc.Utf8);if(d&&c&&d<=0&&c<=0||t<=1||o<=1)try{var p,s=await(await fetch("/history/addHistory",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_username,opponent:(void 0!==e()?e:()=>{if(localStorage.getItem("invited-player")){var e=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8);if(e)return e;window.location.href="/Modified_saved/GameTerminated"}})(),lobbyType:(()=>{if(localStorage.getItem("lobbyType")){var e=CryptoJS.AES.decrypt(localStorage.getItem("lobbyType"),"lobbyType").toString(CryptoJS.enc.Utf8);if(e)return e}window.location.href="/Modified_saved/GameTerminated"})(),time:a(),win_status:t<o?"win":"lose",trophy:global_trophy})})).json();"success"===s.message&&(p=localStorage.getItem("lobby-room"),socket.emit("win-status",global_opponent_username,p,s.win_status),document.getElementById("win_lose-text-display").innerText=(t<o?global_username:global_opponent_username)+" win",document.getElementById("win_lose-text-display").style.color=t<o?"green":"red",document.getElementById("win_lose-time-display").innerText="Time Remaining: "+a(),"Match"===s.status?(document.getElementById("win_lose-time-trophy").innerText="Trophy now: "+s.trophy,document.getElementById("win_lose-time-trophy").style.color=t<o?"green":"red"):document.getElementById("win_lose-time-trophy").innerText="You cannot earn or decrease trophy in custom mode",modalStatus("win_loseNotifModal","win_loseNotifContainer","flex","modal_animation"))}catch(e){console.log(e)}}