var global_username=null,global_profile=null,global_trophy=null,global_requestCount=null;async function fillInfo(){try{var e=await(await fetch("/fillInfo",{method:"POST",headers:{"Content-Type":"Application/json",Accept:"Application/json"},body:JSON.stringify({guaranteedAccess:!0})})).json();"success"===e.message?(global_username=e.username,global_profile=e.profile,global_trophy=e.trophy,0<(global_requestCount=e.requestCount)&&(document.getElementById("notifMsg_friendRequest")&&(document.getElementById("notifMsg_friendRequest").style.display="inline",document.getElementById("notifMsg_friendRequest").innerText=global_requestCount),document.getElementById("m_notifMsg_friendRequest"))&&(document.getElementById("m_notifMsg_friendRequest").style.display="inline",document.getElementById("m_notifMsg_friendRequest").innerText=global_requestCount)):(global_username=e.username,global_profile=e.profile)}catch(e){console.log(e)}}function pageAltered(){var e,t=window.location.href.split("/"),t=t[t.length-1];CryptoJS.AES.decrypt((e="_",t.replace(new RegExp(e,"g"),"/")),"username").toString(CryptoJS.enc.Utf8)||(window.location.href="/InvalidUser/")}async function navigatePage(t){let n=(e,t,n,o,l,a,r,i)=>{try{document.getElementById(e).style.backgroundColor="#1d4ed8",document.getElementById(t).style.backgroundColor="#3b82f6",document.getElementById(n).style.backgroundColor="#3b82f6",document.getElementById(o).style.backgroundColor="#3b82f6",document.getElementById(l).style.backgroundColor="#3b82f6",document.getElementById(a).style.backgroundColor="#3b82f6",document.getElementById(r).style.backgroundColor="#3b82f6",document.getElementById(i).style.backgroundColor="#3b82f6"}catch(e){console.log("Site viewport is mobile/tablet")}};var o=new XMLHttpRequest,e=t;o.onreadystatechange=()=>{if(200===o.status&&4===o.readyState){document.getElementById("contentDiv")&&(document.getElementById("contentDiv").innerHTML=o.responseText);var e=global_username;switch(t){case"/profile.html":n("profileBtn","homeBtn","settingBtn","findFriendBtn","friendListBtn","historyBtn","leaderboardBtn","watchLiveBtn"),e.startsWith("guest")?(document.getElementById("guestProfile").style.display="flex",document.getElementById("loginProfile").style.display="none"):setTimeout(()=>{checkProfile_allowChange(),document.getElementById("userProfileName").innerText=global_username,document.getElementById("userProfile").src=global_profile,document.getElementById("userTrophy").innerText="Trophies: "+global_trophy},10);break;case"/findFriend.html":e.startsWith("guest")&&(document.getElementById("guestFriend").style.display="flex",document.getElementById("loginFriend").style.display="none"),n("findFriendBtn","settingBtn","homeBtn","profileBtn","friendListBtn","historyBtn","leaderboardBtn","watchLiveBtn");break;case"/setting.html":e.startsWith("guest")&&(document.getElementById("guestSetting").style.display="flex",document.getElementById("loginSetting").style.display="none"),n("settingBtn","homeBtn","profileBtn","findFriendBtn","friendListBtn","historyBtn","leaderboardBtn","watchLiveBtn");break;case"/friendList.html":e.startsWith("guest")&&(document.getElementById("guestFriendlist").style.display="flex",document.getElementById("loginFriendlist").style.display="none"),n("friendListBtn","settingBtn","homeBtn","profileBtn","findFriendBtn","historyBtn","leaderboardBtn","watchLiveBtn");break;case"/history.html":e.startsWith("guest")?(document.getElementById("guestHistory").style.display="flex",document.getElementById("loginHistory").style.display="none"):setTimeout(()=>{checkHistory()},10),n("historyBtn","friendListBtn","settingBtn","homeBtn","profileBtn","findFriendBtn","leaderboardBtn","watchLiveBtn");break;case"/leaderboard.html":setTimeout(()=>{displayPlayers_trophies()},10),n("leaderboardBtn","historyBtn","friendListBtn","settingBtn","homeBtn","profileBtn","findFriendBtn","watchLiveBtn");break;case"/watchLive.html":setTimeout(()=>{displayLobby()},10),n("watchLiveBtn","leaderboardBtn","historyBtn","friendListBtn","settingBtn","homeBtn","profileBtn","findFriendBtn");break;default:localStorage.removeItem("invited-player"),localStorage.removeItem("host"),localStorage.removeItem("receiver_private"),localStorage.removeItem("lobby-room"),localStorage.removeItem("turnIndicator"),localStorage.removeItem("destinationTileID"),localStorage.removeItem("originTileID"),localStorage.removeItem("pieceID"),localStorage.removeItem("minute"),localStorage.removeItem("sec"),localStorage.removeItem("win-status"),localStorage.removeItem("lobbyType"),localStorage.removeItem("gameSurrender"),localStorage.removeItem("spectator"),localStorage.removeItem("player_host"),localStorage.removeItem("player_invited");for(let e=0;e<13;e++)localStorage.removeItem("piece"+e),localStorage.removeItem("piece"+e+"_pos"),localStorage.removeItem("eaten_piece"+e),localStorage.removeItem("pieceInput"+e),localStorage.removeItem("opponent_piece"+e),localStorage.removeItem("opponent_piece"+e+"_pos"),localStorage.removeItem("eaten_opponent_piece"+e),localStorage.removeItem("opponent_pieceInput"+e);n("homeBtn","profileBtn","settingBtn","findFriendBtn","friendListBtn","historyBtn","leaderboardBtn","watchLiveBtn")}}},o.open("GET",e,!0),o.send()}async function logout(){document.getElementById("loadingSpinner").style.display="flex",document.getElementById("validateText").innerText="Validating...";var e=CryptoJS.AES.decrypt(localStorage.getItem("username"),"username").toString(CryptoJS.enc.Utf8);e?removeUserList(e):window.location.href="/invalidUser"}function typeInput(e,t,n){t=document.getElementById(t),e=document.getElementById(e);t.innerText=e.value.length+"/"+n}fillInfo(),pageAltered(),navigatePage("/home.html");let showPass=!0;function showInputPass(e,t){showPass=showPass?(document.getElementById(t).src="/Images/Password eye close.png",!(document.getElementById(e).type="text")):(document.getElementById(t).src="/Images/Password eye.png",document.getElementById(e).type="password",!0)}async function proceed(){var e=document.getElementById("settingInputPass"),t=document.getElementById("settingInputRePass");try{var n=await(await fetch("/changeAcc",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_username,password:e.value,newPassword:t.value})})).json();"Change Account Successfully"===n.message&&(document.getElementById("settingInputPass").value="",document.getElementById("settingInputRePass").value=""),document.getElementById("error-text-p").innerText=n.message,document.getElementById("error-text-p").style.color=n.textColor}catch(e){console.log(e)}}function uploadProfile(){document.getElementById("changeProfile").addEventListener("change",async e=>{var e=e.target.files[0],t=new FormData;if(t.append("imageFile",e),t.append("username",global_username),e)try{var n=await(await fetch("/uploadImage",{method:"POST",body:t})).json();"success"===n.message&&(global_profile=n.profile,document.getElementById("userProfile").src=n.profile,document.getElementById("profile_allowChangeBtn").style.backgroundColor="red",document.getElementById("profile_allowChangeBtn").style.pointerEvents="none",document.getElementById("profile_allowChangeBtn").innerText="Wait until "+n.date)}catch(e){console.log(e)}})}async function checkProfile_allowChange(){try{var e=await(await fetch("/uploadImage/checkProfile",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_username})})).json();"allowed"===e.message?(document.getElementById("profile_allowChangeBtn").style.backgroundColor="#3b82f6",document.getElementById("profile_allowChangeBtn").style.pointerEvents="allowed",document.getElementById("profile_allowChangeBtn").innerText="Change Profile"):(document.getElementById("profile_allowChangeBtn").style.backgroundColor="red",document.getElementById("profile_allowChangeBtn").style.pointerEvents="none",document.getElementById("profile_allowChangeBtn").innerText="Wait until "+e.date)}catch(e){console.log(e)}}function restartStatus(){global_messageCount=0,document.getElementById("notifMsg_global").style.display="none"}function closeRequestNotif(){var e=document.getElementById("notifMsg_friendRequest"),t=document.getElementById("m_notifMsg_friendRequest");e&&t&&(document.getElementById("notifMsg_friendRequest").style.display="none",document.getElementById("m_notifMsg_friendRequest").style.display="none")}async function goToCustomLobbyHost(){var e,t=localStorage.getItem("username");document.getElementById("loadingSpinner").style.display="flex",document.getElementById("validateText").innerText="Navigating, please wait...",t&&(document.getElementById("loadingSpinner").style.display="none",imInLobby(!0,global_username),window.location.href="/customLobby/Host/"+(e="_",t.replace(/\//g,e)))}async function goToCustomLobbyInvited(){var e,t=localStorage.getItem("username");t&&(document.getElementById("loadingSpinner").style.display="none",imInLobby(!0,global_username),window.location.href="/customLobby/Invited/"+(e="_",t.replace(/\//g,e)))}function acceptCustomInvite(e,t){socket.emit("room-status",t,"join"),localStorage.setItem("lobby-room",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t),"lobby-room").toString());localStorage.setItem("host",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),"host").toString()),socket.emit("invite-accepted",global_username,global_profile,global_trophy,e),goToCustomLobbyInvited()}function declineCustomInvite(e){socket.emit("invite-declined",global_username,global_profile,e)}function checkLobby(){var e,t=CryptoJS.AES.decrypt(localStorage.getItem("username"),"username").toString(CryptoJS.enc.Utf8);localStorage.getItem("gameSurrender")&&(e=CryptoJS.AES.decrypt(localStorage.getItem("gameSurrender"),"gameSurrender").toString(CryptoJS.enc.Utf8),localStorage.getItem("lobby-room"))&&e&&t&&"manual"===e&&(socket.emit("player_surrender",localStorage.getItem("lobby-room"),t),localStorage.removeItem("gameSurrender"))}function findPlayerMatch(){imInLobby(!0,global_username),socket.emit("findMatch_player",global_username)}function cancel_findPlayerMatch(){var e;imInLobby(!1,global_username),socket.emit("cancel_findMatch_player",global_username),localStorage.getItem("lobby-room")&&(e=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8))&&(socket.on("room-status",e,"leave"),localStorage.removeItem("lobby-room"))}checkLobby();