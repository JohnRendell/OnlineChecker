var global_username=null,global_profile=null,global_trophy=null;async function fillInfo(){try{var e=await(await fetch("/fillInfo",{method:"POST",headers:{"Content-Type":"Application/json",Accept:"Application/json"},body:JSON.stringify({guaranteedAccess:!0})})).json();"success"===e.message&&(global_username=e.username,global_profile=e.profile,global_trophy=e.trophy),onGuestMode()}catch(e){console.log(e)}}function pageAltered(){var e,t=window.location.href.split("/"),t=t[t.length-1];CryptoJS.AES.decrypt((e="_",t.replace(new RegExp(e,"g"),"/")),"username").toString(CryptoJS.enc.Utf8)||(window.location.href="/InvalidUser/")}function typeInput(e,t,o){t=document.getElementById(t),e=document.getElementById(e);t.innerText=e.value.length+"/"+o}async function getParamInvitedPlayer(){var e=window.location.href.split("/");let b=e[e.length-2];var t,e=async e=>{try{var t,o,l,n,r,a,i,s,c,d,m,u,p,y,g=await(await fetch("/customLobby/status",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:e,status:b})})).json();g&&("Invited"===g.status&&(t=g.name,o=g.profile,l=g.trophy,document.getElementById("hostTitle").style.display="none",document.getElementById("customButtonHost").style.display="none",document.getElementById("inviteContainer").style.display="flex",s=document.getElementById("inviteContainer"))&&(document.getElementById("custom-ready-button").style.display="flex",(n=document.createElement("h1")).setAttribute("class","font-Pixelify text-lg text-center text-black"),n.appendChild(document.createTextNode("Host")),s.appendChild(n),(c=document.createElement("img")).setAttribute("alt","User Profile"),c.setAttribute("src","/Profile/"+o),c.setAttribute("class","w-[8rem] h-[8rem] border-2 rounded-full border-blue-500 xsm:w-[5rem] xsm:h-[5rem]"),s.appendChild(c),(d=document.createElement("p")).setAttribute("class","font-Pixelify text-center text-blue-700 text-sm"),d.appendChild(document.createTextNode(t)),s.appendChild(d),(m=document.createElement("p")).setAttribute("class","font-Pixelify text-center text-blue-700 text-sm"),m.appendChild(document.createTextNode("Trophies: "+l)),s.appendChild(m)),"Host"===g.status)&&(r=g.name,a=g.profile,i=g.trophy,document.getElementById("hostTitle").style.display="flex",document.getElementById("customButtonHost").style.display="flex",document.getElementById("inviteContainer").style.display="flex",s=document.getElementById("inviteContainer"))&&((c=document.createElement("img")).setAttribute("alt","User Profile"),c.setAttribute("src","/Profile/"+a),c.setAttribute("class","w-[8rem] h-[8rem] border-2 rounded-full border-blue-500 xsm:w-[5rem] xsm:h-[5rem]"),s.appendChild(c),(d=document.createElement("p")).setAttribute("class","font-Pixelify text-center text-blue-700 text-sm"),d.appendChild(document.createTextNode(r)),s.appendChild(d),(m=document.createElement("p")).setAttribute("class","font-Pixelify text-center text-blue-700 text-sm"),m.appendChild(document.createTextNode("Trophies: "+i)),s.appendChild(m),(u=document.createElement("div")).setAttribute("class","flex flex-row space-x-2"),s.appendChild(u),(p=document.createElement("div")).setAttribute("class","font-Pixelify text-sm text-center text-white bg-blue-500 p-2 rounded-2xl"),p.setAttribute("id","custom-button-ready-"+r),p.appendChild(document.createTextNode("Ready")),u.appendChild(p),(y=document.createElement("button")).setAttribute("class","font-Pixelify text-sm text-center text-white bg-red-500 p-2 rounded-2xl hover:bg-red-700"),y.setAttribute("onclick",'kickPlayer("'+r+'")'),y.appendChild(document.createTextNode("Kick")),u.appendChild(y))}catch(e){console.log(e)}};localStorage.getItem("host")&&(socket.emit("custom-lobby-room-join",localStorage.getItem("host"),localStorage.getItem("username"),b),t=CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8))&&e(t),localStorage.getItem("invited-player")&&(t=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8))&&e(t),localStorage.getItem("invited-player")||localStorage.getItem("host")||socket.emit("custom-lobby-room-join",localStorage.getItem("username"),null,"Host"),localStorage.getItem("lobby-room")&&(e=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("username"),"username").toString(CryptoJS.enc.Utf8),e)&&t&&socket.emit("custom-lobby-room-checker",e,t)}function onGuestMode(){var e=CryptoJS.AES.decrypt(localStorage.getItem("username"),"username").toString(CryptoJS.enc.Utf8);e&&(e.startsWith("guest")?(document.getElementById("loginCustom").style.display="none",document.getElementById("guestCustom").style.display="flex"):(document.getElementById("loginCustom").style.display="flex",document.getElementById("guestCustom").style.display="none",document.getElementById("hostCustomName").innerText=global_username,document.getElementById("hostCustomProfile").src="/Profile/"+global_profile,document.getElementById("hostCustomTrophy").innerText="Trophies: "+global_trophy))}async function dashboard(){var e=CryptoJS.AES.decrypt((e=localStorage.getItem("username"),t="_",e.replace(new RegExp(t,"g"),"/")),"username").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8);e&&t?(localStorage.getItem("invited-player")&&socket.emit("user-leave-custom-lobby","host",t),localStorage.getItem("host")&&socket.emit("user-leave-custom-lobby","invited",t),imInLobby(!1,global_username),socket.emit("room-status",t,"leave"),localStorage.removeItem("host"),localStorage.removeItem("invited-player"),localStorage.removeItem("lobby-room"),document.getElementById("loadingSpinner").style.display="none",window.location.href="/dashboard/"+(e=localStorage.getItem("username"),t="_",e.replace(/\//g,t))):window.location.href="/InvalidURL"}async function inviteFriendChecker(){for(var e=document.getElementById("availableList-custom-container");e.firstElementChild;)e.removeChild(e.firstElementChild);if(0==e.childElementCount)try{var t=await(await fetch("/friendList/availableInvite",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_username})})).json();"success"===t.message?(t.list.forEach(e=>{socket.emit("custom-check-user-active-friend",e.username,e.profile)}),e.style.display="flex",document.getElementById("no-available-invite-customLobby").style.display="none"):(e.style.display="none",document.getElementById("no-available-invite-customLobby").style.display="flex",document.getElementById("custom-data-text").innerText=t.message)}catch(e){console.log(e)}}function invitePlayer(e,t,o){document.getElementById("custom-invite-div-"+e)&&document.getElementById("custom-invite-div-"+e).remove();var l,n=document.getElementById("availableList-custom-container"),t=(n&&0==n.contains(document.getElementById("custom-invite-div"+e))&&((l=document.createElement("div")).setAttribute("class","flex flex-row space-x-2 items-center"),l.setAttribute("id","custom-invite-div-"+e),n.appendChild(l),(n=document.createElement("img")).setAttribute("class","w-[2rem] h-[2rem] rounded-full border-2 border-blue-500"),n.setAttribute("alt","user profile"),n.setAttribute("src","/Profile/"+t),l.appendChild(n),(t=document.createElement("p")).setAttribute("class","font-Pixelify text-sm text-black text-center"),t.appendChild(document.createTextNode(e)),l.appendChild(t),(n=document.createElement("div")).setAttribute("class","loader"),l.appendChild(n)),CryptoJS.AES.decrypt(o,"lobby-room").toString(CryptoJS.enc.Utf8));t&&socket.emit("invite-custom",e,global_username,global_profile,t)}function kickPlayer(e){document.getElementById("inviteContainer").style.display="none";for(var t=document.getElementById("inviteContainer");t.lastElementChild;)t.removeChild(t.lastElementChild);socket.emit("kicked-invited",e),localStorage.removeItem("invited-player"),document.getElementById("custom-start-button").style.backgroundColor="#60a5fa",document.getElementById("custom-start-button").style.cursor="not-allowed",document.getElementById("custom-start-button").style.pointerEvents="none"}function readyButton(){let e=document.getElementById("custom-ready-button"),t=null;var o;t="Ready"===e.innerText?(e.innerText="Cancel","Ready"):(e.innerText="Ready","Not-ready"),localStorage.getItem("host")&&(o=CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8))&&socket.emit("custom-player-ready",o,t,global_username)}function sendMessageCustom(){var e,t,o,l,n=document.getElementById("messageInputCustom");n.value&&(e=document.getElementById("customMessageParent"),(t=document.createElement("div")).setAttribute("class","flex justify-start w-full h-auto"),e.appendChild(t),(l=document.createElement("div")).setAttribute("class","flex flex-col space-y-2 w-fit h-fit"),t.appendChild(l),(t=document.createElement("div")).setAttribute("class","flex flex-row space-x-2 items-center justify-start"),l.appendChild(t),(o=document.createElement("img")).setAttribute("alt","user profile"),o.setAttribute("class","w-[2rem] h-[2rem] text-sm border-2 border-blue-500 rounded-full"),o.setAttribute("src","/Profile/"+global_profile),t.appendChild(o),(o=document.createElement("p")).setAttribute("class","font-Pixelify text-black font-bold text-sm"),o.appendChild(document.createTextNode(global_username)),t.appendChild(o),(t=document.createElement("div")).setAttribute("class","w-[10rem] h-auto text-left bg-blue-500 rounded-2xl p-2 md:w-[15rem]"),l.appendChild(t),(o=document.createElement("p")).setAttribute("class","font-Pixelify text-white text-sm"),o.appendChild(document.createTextNode(n.value)),t.appendChild(o),localStorage.getItem("invited-player")&&(l=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8),l)&&t&&socket.emit("custom-lobby-room-message",n.value,global_username,global_profile,l,t),localStorage.getItem("host")&&(o=CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8),l=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8),o)&&l&&socket.emit("custom-lobby-room-message",n.value,global_username,global_profile,o,l),document.getElementById("messageInputCustom").value="",document.getElementById("messageInputCustomCount").innerText="0/80",e.scrollTo(0,e.scrollHeight))}function resetCustomNotifCount(){customLobby_messageCount=0,document.getElementById("notifMsg_custom").style.display="none"}function gameStart(){var e,t;localStorage.getItem("invited-player")&&((e=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8))&&socket.emit("game-custom-start",e),e=localStorage.getItem("username"),document.getElementById("loadingSpinner").style.display="flex",document.getElementById("validateText").innerText="Navigating, please wait...",CryptoJS.AES.decrypt((t="_",e.replace(new RegExp(t,"g"),"/")),"username").toString(CryptoJS.enc.Utf8)?(document.getElementById("loadingSpinner").style.display="none",window.location.replace("/Checker/Custom-mode/"+(t="_",e.replace(/\//g,t)))):window.location.href="/InvalidUser")}pageAltered(),getParamInvitedPlayer(),fillInfo();