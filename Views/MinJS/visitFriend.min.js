var global_username=null,global_profile=null,global_trophy=null,global_requestCount=null;async function fillInfo(){try{var e=await(await fetch("/fillInfo",{method:"POST",headers:{"Content-Type":"Application/json",Accept:"Application/json"},body:JSON.stringify({guaranteedAccess:!0})})).json();"success"===e.message?(global_username=e.username,global_profile=e.profile,global_trophy=e.trophy,0<(global_requestCount=e.requestCount)&&(document.getElementById("notifMsg_friendRequest")&&(document.getElementById("notifMsg_friendRequest").style.display="inline",document.getElementById("notifMsg_friendRequest").innerText=global_requestCount),document.getElementById("m_notifMsg_friendRequest"))&&(document.getElementById("m_notifMsg_friendRequest").style.display="inline",document.getElementById("m_notifMsg_friendRequest").innerText=global_requestCount)):(global_username=e.username,global_profile=e.profile)}catch(e){console.log(e)}}async function dashboard(){var e,t;document.getElementById("loadingSpinner").style.display="flex",document.getElementById("validateText").innerText="Validating, please wait...",(await fetch("/cookie/getCookie")).ok?CryptoJS.AES.decrypt((e=localStorage.getItem("username"),t="_",e.replace(new RegExp(t,"g"),"/")),"username").toString(CryptoJS.enc.Utf8)?(imInLobby(!1,global_username),document.getElementById("loadingSpinner").style.display="none",window.location.href="/dashboard/"+(e=localStorage.getItem("username"),t="_",e.replace(/\//g,t))):window.location.href="/invalidUser":window.location.href="/noCookies"}fillInfo();var playerName_target=null;async function getParamPlayer(){var e=window.location.href.split("/"),e=e[e.length-1];try{var t=await(await fetch("/player/playerInfo",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:e})})).json();"success"===t.message&&(document.title="Profile - "+t.username,document.getElementById("userProfile").src=t.profile,document.getElementById("userProfileName").innerText=t.username,document.getElementById("userTrophy").innerText="Trophies: "+t.trophy,playerName_target=t.username)}catch(e){console.log(e)}}getParamPlayer();let click=!0;async function checkReqList(){if(localStorage.getItem("username")){var e=CryptoJS.AES.decrypt(localStorage.getItem("username"),"username").toString(CryptoJS.enc.Utf8);if(e&&playerName_target)try{var t=await(await fetch("/friendList/checkUserRequest",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:e,playerName:playerName_target})})).json();"pending"===t.status?(click=!1,document.getElementById("addFriendBtn").disabled=!1,document.getElementById("addFriendBtn").style.pointerEvents="auto",document.getElementById("addFriendBtn").style.backgroundColor="#3b82f6",document.getElementById("addFriendBtn").innerText="Cancel"):"not yet"===t.status?(click=!0,document.getElementById("addFriendBtn").disabled=!1,document.getElementById("addFriendBtn").style.pointerEvents="auto",document.getElementById("addFriendBtn").style.backgroundColor="#3b82f6",document.getElementById("addFriendBtn").innerText="Add Friend"):"friend"===t.status&&(document.getElementById("addFriendBtn").disabled=!0,document.getElementById("addFriendBtn").style.pointerEvents="not-allowed",document.getElementById("addFriendBtn").style.backgroundColor="green",document.getElementById("addFriendBtn").innerText="Friend")}catch(e){console.log(e)}}}async function clickAddBtn(){try{var e=document.getElementById("addFriendBtn").innerText,t=await(await fetch("/friendList/request",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_username,playerName:playerName_target,status:e})})).json();"success"===t.message&&(click?(document.getElementById("addFriendBtn").innerText="Cancel",click=!1,socket.emit("notify-player-request",playerName_target,"Add Friend",t.player)):(document.getElementById("addFriendBtn").innerText="Add Friend",click=!0,socket.emit("notify-player-request",playerName_target,"Cancel",t.player)))}catch(e){console.log(e)}}async function add_each_other(){try{"success"===(await(await fetch("/friendList/addOnVisitPage",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_username,playerTarget:playerName_target})})).json()).message&&(document.getElementById("addFriendBtn").disabled=!0,document.getElementById("addFriendBtn").style.pointerEvents="not-allowed",document.getElementById("addFriendBtn").style.backgroundColor="green",document.getElementById("addFriendBtn").innerText="Friend",socket.emit("both_request",playerName_target))}catch(e){console.log(e)}}function restartStatus(){global_messageCount=0,document.getElementById("notifMsg_global").style.display="none"}function displayProfile(){var e=document.getElementById("userHistoryContainer");if(e)for(;0<e.childElementCount;)e.removeChild(e.firstChild);document.getElementById("userHistory")&&document.getElementById("loginProfile")&&(document.getElementById("userHistory").style.display="none",document.getElementById("loginProfile").style.display="flex"),document.getElementById("profileBtn")&&document.getElementById("historyBtn")&&(document.getElementById("profileBtn").style.backgroundColor="#1d4ed8",document.getElementById("historyBtn").style.backgroundColor="#3b82f6")}async function displayUserHistory(){var t,n,o,d,l,a,r,i,e=document.getElementById("userHistoryContainer");if(e)for(;0<e.childElementCount;)e.removeChild(e.firstChild);document.getElementById("userHistoryTitle")&&(document.getElementById("userHistoryTitle").innerText=playerName_target+"'s History"),document.getElementById("userHistory")&&document.getElementById("loginProfile")&&(document.getElementById("userHistory").style.display="flex",document.getElementById("loginProfile").style.display="none"),document.getElementById("historyBtn")&&document.getElementById("profileBtn")&&(document.getElementById("historyBtn").style.backgroundColor="#1d4ed8",document.getElementById("profileBtn").style.backgroundColor="#3b82f6");try{document.getElementById("searchLoader")&&(document.getElementById("searchLoader").style.display="flex");var s=await(await fetch("/history/displayHistory",{method:"POST",headers:{"Content-Type":"Application/json",Accept:"Application/json"},body:JSON.stringify({username:playerName_target})})).json();if("success"===s.message){document.getElementById("searchLoader")&&(document.getElementById("searchLoader").style.display="none");for(let e=0;e<s.historyCount;e++){var c=s.history[e],m=c.win_status;n=c.lobbyType,o=c.opponent,d=c.time,l=c.date,a=c.trophy,r=i=r=void 0,t="win"===(t=m)?"from-green-500":"from-red-500",r=document.getElementById("userHistoryContainer"),(i=document.createElement("div")).setAttribute("class","w-full h-fit p-2 grid grid-rows-2 bg-gradient-to-r "+t+" to-blue-500 rounded-2xl items-center"),r.appendChild(i),(t=document.createElement("div")).setAttribute("class","flex flex-row space-x-2 justify-start"),i.appendChild(t),(r=document.createElement("p")).setAttribute("class","font-Pixelify text-[12px] text-center text-white font-bold xsm:text-[10px] md:text-sm"),r.appendChild(document.createTextNode(n)),t.appendChild(r),(n=document.createElement("p")).setAttribute("class","font-Pixelify text-[12px] text-center text-white font-bold xsm:text-[10px] md:text-sm"),n.appendChild(document.createTextNode(l)),t.appendChild(n),(r=document.createElement("p")).setAttribute("class","font-Pixelify text-[12px] text-center text-white font-bold xsm:text-[10px] md:text-sm"),r.appendChild(document.createTextNode(playerName_target+" vs "+o)),i.appendChild(r),(l=document.createElement("div")).setAttribute("class","flex flex-row space-x-2 justify-end"),i.appendChild(l),(t=document.createElement("p")).setAttribute("class","font-Pixelify text-[12px] text-center text-white font-bold xsm:text-[10px] md:text-sm"),t.appendChild(document.createTextNode("Time Remaining: "+d)),l.appendChild(t),(n=document.createElement("p")).setAttribute("class","font-Pixelify text-[12px] text-center text-white font-bold xsm:text-[10px] md:text-sm"),n.appendChild(document.createTextNode("Trophy earn: "+a)),l.appendChild(n)}}}catch(e){console.log(e)}}window.onload=setTimeout(()=>{checkReqList()},100),displayProfile();