let socket=io(),messageCount=(socket.on("connect",async()=>{document.getElementById("loadingSpinner").style.display="flex",document.getElementById("validateText").innerText="Game loading, please wait for a moment...";var e=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8);if(e){if(socket.emit("room-status",e,"join"),localStorage.getItem("host")||localStorage.getItem("invited-player"))if(document.getElementById("playerSurrBtn").style.display="block",document.getElementById("spectatorBtn").style.display="none",localStorage.getItem("invited-player")&&!localStorage.getItem("minute")&&!localStorage.getItem("sec")){let e=document.getElementById("checkerTime"),t=10,o=0,n=setInterval(()=>{0===t&&0===o?(clearInterval(n),e.innerText="00:00",checkBoardStatus()):(0===o?(o=59,t--):o--,e.innerText=(t<10?"0"+t:t)+":"+(o<10?"0"+o:o),localStorage.setItem("minute",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t),"minute").toString()),localStorage.setItem("sec",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(o),"sec").toString()),socket.emit("spectator_time",t,o,localStorage.getItem("lobby-room")),socket.emit("game_time",t,o,localStorage.getItem("lobby-room")))},1e3)}localStorage.getItem("spectator")&&(document.getElementById("playerSurrBtn").style.display="none",document.getElementById("spectatorBtn").style.display="block"),document.getElementById("loadingSpinner").style.display="none",CryptoJS.AES.decrypt(localStorage.getItem("username"),"username").toString(CryptoJS.enc.Utf8)&&(addUserList(localStorage.getItem("username")),socket.emit("connected-users",localStorage.getItem("username")))}}),socket.on("game_time",(e,t)=>{localStorage.getItem("host")&&(document.getElementById("checkerTime").innerText=(e<10?"0"+e:e)+":"+(t<10?"0"+t:t),localStorage.setItem("minute",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),"minute").toString()),localStorage.setItem("sec",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t),"sec").toString()))}),0);socket.on("gameMessage",(t,o,n)=>{messageCount++,document.getElementById("notifMsg_game")&&(document.getElementById("notifMsg_game").style.display="inline",document.getElementById("notifMsg_game").innerText=messageCount);var r=document.getElementById("gameMessageConversation");if(r){var a=document.createElement("div"),l=(a.setAttribute("class","flex justify-end w-full h-auto"),r.appendChild(a),document.createElement("div")),a=(l.setAttribute("class","flex flex-col space-y-2 w-fit h-fit"),a.appendChild(l),document.createElement("div")),i=(a.setAttribute("class","flex flex-row space-x-2 items-center justify-end"),l.appendChild(a),document.createElement("p"));i.setAttribute("class","font-Pixelify text-black font-bold text-sm");let e;var c=!!localStorage.getItem("invited-player")&&CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8),s=!!localStorage.getItem("host")&&CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8),m=!!localStorage.getItem("player_host")&&CryptoJS.AES.decrypt(localStorage.getItem("player_host"),"player_host").toString(CryptoJS.enc.Utf8),d=!!localStorage.getItem("player_invited")&&CryptoJS.AES.decrypt(localStorage.getItem("player_invited"),"player_invited").toString(CryptoJS.enc.Utf8),c=(e=c&&c===o||s&&s===o||d&&d===o||m&&m===o?o:o+" (Spectator)",i.appendChild(document.createTextNode(e)),a.appendChild(i),document.createElement("img")),s=(c.setAttribute("alt","user profile"),c.setAttribute("class","w-[2rem] h-[2rem] border-2 border-blue-500 rounded-full"),c.setAttribute("src","/Profile/"+n),a.appendChild(c),document.createElement("div")),d=(s.setAttribute("class","w-[10rem] h-auto text-left bg-blue-700 rounded-2xl p-2 md:w-[15rem]"),l.appendChild(s),document.createElement("p"));d.setAttribute("class","font-Pixelify text-white text-sm"),d.appendChild(document.createTextNode(t)),s.appendChild(d),r.scrollTo(0,r.scrollHeight)}}),socket.on("checker-player-move",(e,t)=>{var o="opponent_"+e,n=document.getElementById(o),r="abcdefgh".toUpperCase().split(""),t=t.split(""),a=t[t.length-1],t=t[t.length-2],a=r.length-1-r.indexOf(a),t=document.getElementById("tile_"+(9-t)+r[a]);t&&(localStorage.getItem("host")||localStorage.getItem("invited-player"))&&n&&(t.appendChild(n),localStorage.getItem("invited-player")&&socket.emit("spectator_moveRed",o,t.id,localStorage.getItem("lobby-room")),localStorage.setItem(o+"_pos",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t.id),o+"_pos").toString()),"pawn"!==document.getElementById("opponent_pieceInput"+e.substring(5).trim()).value||"tile_8A"!==t.id&&"tile_8C"!==t.id&&"tile_8E"!==t.id&&"tile_8G"!==t.id||((r=document.getElementById("opponent_pieceInput"+e.substring(5).trim()))&&localStorage.setItem("opponent_pieceInput"+e.substring(5).trim(),CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(r.value),"opponent_pieceInput"+e.substring(5).trim()).toString()),modalStatus("promotedModal","promotedContainer","flex","modal_animation"),document.getElementById("promoteLabel").innerText=global_opponent_username+" piece's promoted",document.getElementById("opponent_pieceInput"+e.substring(5).trim()).value="queen",(a=document.createElement("img")).setAttribute("class","w-full h-full"),a.setAttribute("src","/Images/Crown.png"),a.setAttribute("alt","Crown icon"),n.appendChild(a),document.getElementById("promotedContainer").addEventListener("animationend",()=>{setTimeout(()=>{modalStatus("promotedModal","promotedContainer","none",null)},1e3)}),localStorage.setItem("opponent_pieceInput"+e.substring(5).trim(),CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(r.value),"opponent_pieceInput"+e.substring(5).trim()).toString()),localStorage.getItem("invited-player")&&socket.emit("spectator_promoteRed",o,"opponent_pieceInput"+e.substring(5).trim(),localStorage.getItem("lobby-room"),global_opponent_username)))}),socket.on("checker-player-eat-piece",e=>{if(localStorage.getItem("host")||localStorage.getItem("invited-player"))for(var t of e){let e=t.substring(9).trim();localStorage.setItem("turnIndicator",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse("no"),"turnIndicator").toString()),localStorage.setItem("eaten_"+e,CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),"eaten_"+e).toString()),document.getElementById(e).style.animation="shrinkPiece 1s normal forwards",document.getElementById(e).addEventListener("animationend",()=>{document.getElementById(e).remove()}),localStorage.getItem("invited-player")&&socket.emit("spectator_eatenAlly",e,localStorage.getItem("lobby-room"));var t=document.getElementById("userTurnProfile"),o=document.getElementById("userTurnIndicator");t&&o&&(t.src="/Profile/"+global_opponent_profile,o.innerText=global_opponent_username+" turn")}}),socket.on("checker-player-turn",e=>{let t="yes"===e?"no":"yes",o=document.getElementById("userTurnProfile"),n=document.getElementById("userTurnIndicator");var r;(localStorage.getItem("host")||localStorage.getItem("invited-player"))&&("no"==t?(o&&(o.src="/Profile/"+global_opponent_profile),n&&(n.innerText=global_opponent_username+" turn")):(o&&(o.src="/Profile/"+global_profile),n&&(n.innerText=global_username+" turn")),localStorage.setItem("turnIndicator",CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t),"turnIndicator").toString())),localStorage.getItem("invited-player")&&(r=CryptoJS.AES.decrypt(localStorage.getItem("lobby-room"),"lobby-room").toString(CryptoJS.enc.Utf8))&&socket.emit("spectator_turnIndicator",localStorage.getItem("turnIndicator"),r,"yes"===e?global_opponent_username:global_username,"yes"===e?global_opponent_profile:global_profile)}),socket.on("checker-player-surrender",async e=>{var t=()=>{if(localStorage.getItem("host")){var e=CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8);if(e)return e}},o=()=>{if(localStorage.getItem("minute")&&localStorage.getItem("sec")){var e=CryptoJS.AES.decrypt(localStorage.getItem("minute"),"minute").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("sec"),"sec").toString(CryptoJS.enc.Utf8);if(e&&t)return(e<10?"0"+e:e)+":"+(t<10?"0"+t:t)}window.location.href="/Modified_saved/GameTerminated"};if(localStorage.getItem("host")||localStorage.getItem("invited-player"))try{var n=await(await fetch("/history/addHistory",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_username,opponent:(void 0!==t()?t:()=>{if(localStorage.getItem("invited-player")){var e=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8);if(e)return e;window.location.href="/Modified_saved/GameTerminated"}})(),lobbyType:(()=>{if(localStorage.getItem("lobbyType")){var e=CryptoJS.AES.decrypt(localStorage.getItem("lobbyType"),"lobbyType").toString(CryptoJS.enc.Utf8);if(e)return e}window.location.href="/Modified_saved/GameTerminated"})(),time:o(),win_status:"win",trophy:global_trophy})})).json();"success"===n.message&&(modalStatus("surrenderNotifModal","surrenderNotifContainer","flex","modal_animation"),document.getElementById("surrenderNotif-text-display").innerText=e+" surrendered",document.getElementById("win-status").innerText="You win",document.getElementById("win-status").style.color="green",document.getElementById("win-status-time-display").innerText="Time Remaining: "+o(),"Match"===n.status?(document.getElementById("win-status-trophy").innerText="Trophy now: "+n.trophy,document.getElementById("win-status-trophy").style.color="green"):document.getElementById("win-status-trophy").innerText="You cannot earn or decrease trophy in custom mode")}catch(e){console.log(e)}localStorage.getItem("spectator")&&(modalStatus("surrenderNotifModal","surrenderNotifContainer","flex","modal_animation"),document.getElementById("surrenderNotif-text-display").innerText=e+" surrendered",document.getElementById("win-status-time-display").innerText="Time Remaining: "+o())}),socket.on("player_surrender",async e=>{async function t(){try{"success"!==(await(await fetch("/history/addHistory",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_opponent_username,opponent:global_username,lobbyType:(()=>{if(localStorage.getItem("lobbyType")){var e=CryptoJS.AES.decrypt(localStorage.getItem("lobbyType"),"lobbyType").toString(CryptoJS.enc.Utf8);if(e)return e}window.location.href="/Modified_saved/GameTerminated"})(),time:(()=>{if(localStorage.getItem("minute")&&localStorage.getItem("sec")){var e=CryptoJS.AES.decrypt(localStorage.getItem("minute"),"minute").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("sec"),"sec").toString(CryptoJS.enc.Utf8);if(e&&t)return(e<10?"0"+e:e)+":"+(t<10?"0"+t:t)}window.location.href="/Modified_saved/GameTerminated"})(),win_status:"lose",trophy:global_opponent_trophy})})).json()).message&&console.log("failed to add")}catch(e){console.log(e)}}var o=()=>{if(localStorage.getItem("host")){var e=CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8);if(e)return e}},n=()=>{if(localStorage.getItem("minute")&&localStorage.getItem("sec")){var e=CryptoJS.AES.decrypt(localStorage.getItem("minute"),"minute").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("sec"),"sec").toString(CryptoJS.enc.Utf8);if(e&&t)return(e<10?"0"+e:e)+":"+(t<10?"0"+t:t)}window.location.href="/Modified_saved/GameTerminated"};if(localStorage.getItem("host")||localStorage.getItem("invited-player"))try{var r=await(await fetch("/history/addHistory",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:global_username,opponent:(void 0!==o()?o:()=>{if(localStorage.getItem("invited-player")){var e=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8);if(e)return e;window.location.href="/Modified_saved/GameTerminated"}})(),lobbyType:(()=>{if(localStorage.getItem("lobbyType")){var e=CryptoJS.AES.decrypt(localStorage.getItem("lobbyType"),"lobbyType").toString(CryptoJS.enc.Utf8);if(e)return e}window.location.href="/Modified_saved/GameTerminated"})(),time:n(),win_status:"win",trophy:global_trophy})})).json();"success"===r.message&&(t(),modalStatus("surrenderNotifModal","surrenderNotifContainer","flex","modal_animation"),document.getElementById("surrenderNotif-text-display").innerText=e+" surrendered",document.getElementById("win-status").innerText="You win",document.getElementById("win-status").style.color="green",document.getElementById("win-status-time-display").innerText="Time Remaining: "+n(),"Match"===r.status?(document.getElementById("win-status-trophy").innerText="Trophy now: "+r.trophy,document.getElementById("win-status-trophy").style.color="green"):document.getElementById("win-status-trophy").innerText="You cannot earn or decrease trophy in custom mode")}catch(e){console.log(e)}localStorage.getItem("spectator")&&(modalStatus("surrenderNotifModal","surrenderNotifContainer","flex","modal_animation"),document.getElementById("surrenderNotif-text-display").innerText=e+" surrendered",document.getElementById("win-status-time-display").innerText="Time Remaining: "+n())}),socket.on("win-status",async(e,t)=>{var o=()=>{if(localStorage.getItem("host")){var e=CryptoJS.AES.decrypt(localStorage.getItem("host"),"host").toString(CryptoJS.enc.Utf8);if(e)return e}},n=()=>{if(localStorage.getItem("minute")&&localStorage.getItem("sec")){var e=CryptoJS.AES.decrypt(localStorage.getItem("minute"),"minute").toString(CryptoJS.enc.Utf8),t=CryptoJS.AES.decrypt(localStorage.getItem("sec"),"sec").toString(CryptoJS.enc.Utf8);if(e&&t)return(e<10?"0"+e:e)+":"+(t<10?"0"+t:t)}window.location.href="/Modified_saved/GameTerminated"};if(localStorage.getItem("host")||localStorage.getItem("invited-player"))try{var r=await(await fetch("/history/addHistory",{method:"POST",headers:{Accept:"Application/json","Content-Type":"Application/json"},body:JSON.stringify({username:e,opponent:(void 0!==o()?o:()=>{if(localStorage.getItem("invited-player")){var e=CryptoJS.AES.decrypt(localStorage.getItem("invited-player"),"invited-player").toString(CryptoJS.enc.Utf8);if(e)return e;window.location.href="/Modified_saved/GameTerminated"}})(),lobbyType:(()=>{if(localStorage.getItem("lobbyType")){var e=CryptoJS.AES.decrypt(localStorage.getItem("lobbyType"),"lobbyType").toString(CryptoJS.enc.Utf8);if(e)return e}window.location.href="/Modified_saved/GameTerminated"})(),time:n(),win_status:"win"===t?"lose":"win",trophy:global_trophy})})).json();"success"===r.message&&(document.getElementById("win_lose-text-display").innerText="win"===t?e+" lose":e+" win",document.getElementById("win_lose-text-display").style.color="win"===t?"red":"green",document.getElementById("win_lose-time-display").innerText="Time Remaining: "+n(),"Match"===r.status?(document.getElementById("win_lose-time-trophy").innerText="Trophy now: "+r.trophy,document.getElementById("win_lose-time-trophy").style.color="win"===t?"red":"green"):document.getElementById("win_lose-time-trophy").innerText="You cannot earn or decrease trophy in custom mode",modalStatus("win_loseNotifModal","win_loseNotifContainer","flex","modal_animation"))}catch(e){console.log(e)}localStorage.getItem("spectator")&&(document.getElementById("win_lose-text-display").innerText=e+" "+t,document.getElementById("win_lose-text-display").style.color="black",document.getElementById("win_lose-time-display").innerText="Time Remaining: "+n(),modalStatus("win_loseNotifModal","win_loseNotifContainer","flex","modal_animation"))});